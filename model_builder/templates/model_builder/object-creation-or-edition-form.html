{% extends "model_builder/object-panel-template.html" %}

{% block object_panel_content %}
<form class="d-flex flex-column gap-4 mt-4"
      hx-post="{{ form_target_url }}"
      hx-vals='{"obj_type": "{{ obj_type }}", "obj_id": "{{ object_id }}" }'
      hx-swap="none"
      hx-indicator="#graph-loader,#create-new-object-button-loader"
      onsubmit="
          document.querySelector('#create-new-object-button span').style.opacity = 0.5;
          if (document.querySelector('#graph-comparison-image')) document.querySelector('#graph-comparison-image').remove();
          document.querySelector('#graph-container').firstElementChild.remove();
      ">
    <div class="row align-items-center mb-3">
        <label for="new-object-name" class="col-4 col-form-label fw-bold text-end">Name</label>
        <div class="col-8">
            <input id="new-object-name" type="text" name="name" class="form-control rounded-2" value="{{ default_name }}" required>
        </div>
    </div>

    {% for numerical_attribute in numerical_attributes %}
        <div class="row align-items-center mb-3">
            <label for="{{ numerical_attribute.attr_name }}" class="col-4 col-form-label fw-bold text-end">{{ numerical_attribute.attr_name }}</label>
            <div class="col-5">
                <input id="{{ numerical_attribute.attr_name }}" type="number" step="0.01" name="{{ numerical_attribute.attr_name }}" class="form-control rounded-2" value="{{ numerical_attribute.default_value }}">
            </div>
            <div class="col-3">
                <input name="{{ numerical_attribute.attr_name }}" class="form-control-plaintext" readonly value="{{ numerical_attribute.unit }}">
            </div>
        </div>
    {% endfor %}

    {% for modeling_obj_attribute in modeling_obj_attributes %}
        <div class="row align-items-center mb-3">
            <label for="{{ modeling_obj_attribute.attr_name }}" class="col-4 col-form-label fw-bold text-end">{{ modeling_obj_attribute.object_type }}</label>
            <div class="col-8">
                <select id="{{ modeling_obj_attribute.attr_name }}" name="{{ modeling_obj_attribute.attr_name }}" class="form-select rounded-2">
                    {% for existing_object in modeling_obj_attribute.existing_objects %}
                        <option value="{{ existing_object.id }}" {% if existing_object.id == modeling_obj_attribute.selected %} selected {% endif %}>{{ existing_object.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    {% endfor %}

    {% for list_attribute in list_attributes %}
        <div class="row align-items-center mb-3">
            <label for="{{ list_attribute.attr_name }}" class="col-4 col-form-label fw-bold text-end">{{ list_attribute.object_type }}</label>
            <div class="col-8">
                <div id="{{ list_attribute.attr_name }}" class="d-flex flex-column gap-2">
                    {% for existing_object in list_attribute.existing_objects %}
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="{{ existing_object.id }}" id="checkbox-{{ existing_object.id }}" name="{{ list_attribute.attr_name }}" {% if existing_object.id in list_attribute.selected %} checked {% endif %}>
                            <label class="form-check-label" for="checkbox-{{ existing_object.id }}">{{ existing_object.name }}</label>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endfor %}

    <div id="error-message" class="text-danger d-none">Please select at least one option.</div>

    <div class="d-flex justify-content-end gap-3">
        <button id="create-new-object-button" type="submit" class="btn btn-primary bg-primary rounded-pill px-4 py-2 position-relative">
            <img id="create-new-object-button-loader" src="/static/loaders/bars-white.svg" class="position-absolute top-50 start-50 translate-middle d-none" alt="Loader">
            <span>{{ output_button_label }}</span>
        </button>
    </div>
</form>
{% endblock %}
